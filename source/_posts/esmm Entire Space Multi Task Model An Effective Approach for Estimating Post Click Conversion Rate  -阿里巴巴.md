---
title: esmm Entire Space Multi Task Model An Effective Approach for Estimating Post Click Conversion Rate  -阿里巴巴
date: 2023-09-16 12:12:00
categories:
  - 排序模型
tags:
  - 预估模型 
  - esmm 
  - post-click conversion rate
  - multi-task learning
  - sample selection bias
  - data sparsity
  - entire-space modeling 
  - Recommender systems
description: 通过充分利用用户行为的顺序模式，即印象→点击→转化，以全新的视角对CVR进行建模.
cover: https://cdn.jsdelivr.net/gh/1oscar/image_house@main/2023-09-26_130110.png
---

## 摘要

准确估计后点击转化率（CVR）对于工业应用中的排名系统非常关键，例如推荐和广告。

传统的CVR建模应用流行的深度学习方法，达到了最先进的性能。

然而，在实践中，CVR建模面临一些特定任务的问题，使其具有挑战性。

例如，传统的CVR模型是使用点击的样本进行训练的，而在整个空间上进行推断时使用所有印象的样本。这会导致样本选择偏差的问题。此外，还存在极端的数据稀疏问题，使模型拟合变得相当困难。

在本文中，我们通过充分利用用户行为的顺序模式，即印象→点击→转化，以全新的视角对CVR进行建模。

提出的整体空间多任务模型（ESMM）可以通过以下两种方式同时解决这两个问题：

i）直接在整个空间上建模CVR，

ii）采用特征表示迁移学习策略。

我们通过从淘宝推荐系统的流量日志中收集的数据集进行实验，结果表明ESMM明显优于竞争方法。

我们还发布了这个数据集的采样版本，以促进未来的研究。据我们所知，这是第一个包含点击和转化标签的样本具有顺序依赖性的CVR建模的公开数据集。



## 提出的方法

### 符号表示

我们假设观察到的数据集为S = {(xi, yi → zi)}|N i=1，其中样本(x, y → z)来自分布D，其定义域为X × Y × Z，其中X表示特征空间，Y和Z表示标签空间，N表示总的印象数量。x表示观察到的印象的特征向量，通常是一个高维稀疏向量，具有多个字段[8]，例如用户字段、物品字段等。y和z是二进制标签，其中y = 1或z = 1表示是否发生点击或转化事件。y → z表示点击和转化标签之间的顺序依赖关系，即在发生转化事件时总会有一个先前的点击事件。

后点击CVR建模是为了估计pCVR = p(z = 1|y = 1, x)的概率。与之相关的两个概率是：后观看点击率（CTR）pCTR = p(z = 1|x)和后观看点击与转化率（CTCVR）pCTCVR = p(y = 1, z = 1|x)。在给定印象x的情况下，这些概率遵循以下公式（1）：


![](https://cdn.jsdelivr.net/gh/1oscar/image_house@main/2023-09-26_130354.png)

### CVR建模和挑战

最近，基于深度学习的方法已经被提出用于CVR建模，并取得了最先进的性能。其中大多数方法都采用了类似的嵌入和MLP网络架构，如[3]中所介绍的。图2的左侧部分展示了这种架构，出于简化的目的，我们将其称为BASE模型。

简而言之，传统的CVR建模方法直接估计后点击转化率p(z = 1|y = 1, x)。它们使用点击印象的样本进行模型训练，即Sc = {(xj, zj)|yj = 1}|M j=1。


![](https://cdn.jsdelivr.net/gh/1oscar/image_house@main/2023-09-26_130110.png)

M是所有印象中的点击次数。显然，Sc是S的一个子集。注意，在Sc中，（被点击的）印象没有转化被视为负样本，而具有转化（也被点击）的印象被视为正样本。在实践中，CVR建模面临一些特定任务的问题，使其具有挑战性。

 **样本选择偏差（SSB）[12]。**
 
 事实上，传统的CVR建模通过引入辅助特征空间Xc来对p(z = 1|y = 1, x)进行近似估计，即p(z = 1|y = 1, x) ≈ q(z = 1|xc)。Xc表示与Sc相关的有限2的空间。对于Xc中的任何xc，都存在一对（x = xc，yx = 1），其中x ∈ X且yx是x的点击标签。这样，q(z = 1|xc)是使用Sc的点击样本在空间Xc上训练的。在推断阶段，对整个空间X的p(z = 1|y = 1, x)的预测被计算为q(z = 1|x)，假定对于任何一对（x，yx = 1），其中x ∈ X，x属于Xc。这一假设很可能被违反，因为Xc只是整个空间X的一小部分。它受到极少发生的点击事件的随机性的影响，该事件的概率在空间X的不同区域变化。此外，在实践中，由于观察不足，空间Xc可能与X相差很大。这将导致训练样本的分布漂移离真正的底层分布，并影响CVR建模的泛化性能。

 **数据稀疏性（DS）。**
 
 
 传统方法使用Sc的点击样本来训练CVR模型。点击事件的罕见发生导致CVR建模的训练数据极度稀疏。从直观上看，通常比相关的CTR任务要稀疏1-3个数量级，CTR任务是在包含所有印象的S数据集上训练的。表1显示了我们实验数据集的统计数据，其中CVR任务的样本数仅为CTR任务的4%。


**整个空间多任务模型（ESMM）**

所提出的ESMM如图2所示，充分利用了用户行为的顺序模式。借鉴了多任务学习的思想[9]，ESMM引入了CTR和CTCVR两个辅助任务，并同时消除了CVR建模中前面提到的问题。
总体上，ESMM同时输出了与给定印象相关的pCTR、pCVR以及pCTCVR。它主要包括两个子网络：图2左侧显示的CVR网络和右侧的CTR网络。CVR和CTR网络都采用了与BASE模型相同的结构。CTCVR将CVR和CTR网络的输出相乘作为输出。ESMM中有一些亮点，对CVR建模产生了显著影响，并使ESMM与传统方法有所区别。
全空间建模。公式（1）给了我们一些提示，可以转化成公式（2）。

![](https://cdn.jsdelivr.net/gh/1oscar/image_house@main/2023-09-26_130644.png)



## **实验**

**实验设置**

**数据集**。

在我们的调查中，没有在CVR建模领域找到具有点击和转化顺序标签的公共数据集。为了评估所提出的方法，我们收集了淘宝推荐系统的流量日志，并发布了整个数据集的1%随机抽样版本，其大小仍然达到38GB（未经压缩）。在本文的其余部分，我们将发布的数据集称为公共数据集，将整个数据集称为产品数据集。表1总结了这两个数据集的统计信息。详细描述可以在公共数据集的网站上找到。

**竞争对手**。

我们在CVR建模上进行了几种竞争方法的实验。 

(1) BASE是在第2.2节中介绍的基线模型。 

(2) AMAN [6] 应用了负采样策略，并报告了在采样率搜索中获得的最佳结果 {10％，20％，50％，100％}。

(3) OVERSAMPLING [11] 复制正样本以减少稀疏数据训练的难度，采样率在 {2, 3, 5, 10} 中搜索。 

(4) UNBIAS遵循[10]，通过拒绝抽样从观察中拟合真正的底层分布。 pCTR被视为拒绝概率。 

(5) DIVISION使用单独训练的CTR和CTCVR网络估计pCTR和pCTCVR，并通过公式(2)计算pCVR。 

(6) ESMM-NS是ESMM的轻量版，不共享嵌入参数。前四种方法是基于最先进的深度网络直接建模CVR的不同变种。DIVISION、ESMM-NS和ESMM都采用了相同的思想，模型CVR覆盖整个空间，涉及CVR、CTR和CTCVR三个网络。

ESMM-NS和ESMM同时训练这三个网络，并采用CVR网络的输出进行模型比较。为了公平起见，包括ESMM在内的所有竞争对手都与BASE模型共享相同的网络结构和超参数，其中 

i) 使用ReLU激活函数，

ii) 将嵌入向量的维度设置为18，

iii) 将MLP网络中每个层的维度设置为360×200×80×2，

iv) 使用带有参数β1 = 0.9、β2 = 0.999、ϵ = 10−8的adam求解器。


**指标**。

比较是针对两个不同的任务进行的：

(1) 传统CVR预测任务，该任务估计具有点击印象的数据集上的pCVR，

(2) CTCVR预测任务，该任务估计所有印象数据集上的pCTCVR。任务(2)旨在比较不同的CVR建模方法在整个输入空间上，这反映了与SSB问题相对应的模型性能。在CTCVR任务中，

所有模型都通过pCTR×pCVR计算pCTCVR，

其中：

i) 分别由每个模型估算pCVR，

ii) pCTR是由独立训练的相同CTR网络估算的（与BASE模型相同的结构和超参数）。这两个任务中，前1/2的数据按时间顺序分为训练集，其余数据为测试集。

面积下的受试者工作特征曲线（AUC）被采用作为性能指标。所有实验重复进行10次，并报告平均结果。

![](https://cdn.jsdelivr.net/gh/1oscar/image_house@main/2023-09-26_130923.png)



## 结论与未来工作

在本文中，我们提出了一种用于CVR建模任务的新方法ESMM。ESMM充分利用了用户行为的顺序模式。借助CTR和CTCVR两个辅助任务的帮助，ESMM巧妙地解决了实际中CVR建模面临的样本选择偏差和数据稀疏性等挑战。

对真实数据集的实验表明，所提出的ESMM方法具有卓越的性能。

这种方法可以轻松推广到具有顺序依赖性的情境中的用户行为预测。未来，我们打算设计全局优化模型，用于具有多个阶段行动的应用，例如请求 → 曝光 → 点击 → 转化。


## 原文link

https://arxiv.org/pdf/1804.07931.pdf





